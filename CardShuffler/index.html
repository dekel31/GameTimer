<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Persistent Deck Manager</title>
    <style>
        body { font-family: 'Segoe UI', system-ui, sans-serif; max-width: 650px; margin: 20px auto; padding: 20px; background-color: #f0f2f5; color: #333; }
        .card-panel { background: white; padding: 20px; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); margin-bottom: 20px; }
        .input-group { display: flex; gap: 10px; margin-bottom: 20px; }
        input { padding: 10px; border: 1px solid #ddd; border-radius: 6px; flex: 1; }
        button { padding: 10px 16px; border: none; border-radius: 6px; cursor: pointer; font-weight: bold; transition: opacity 0.2s; }
        button:hover { opacity: 0.9; }
        .btn-add { background: #007bff; color: white; }
        .btn-draw { background: #28a745; color: white; width: 100%; font-size: 1.2rem; margin-bottom: 10px; }
        .btn-shuffle { background: #6f42c1; color: white; flex: 1; }
        .btn-clear { background: #dc3545; color: white; flex: 1; }
        button:disabled { background: #ccc; cursor: not-allowed; }
        .display-area { text-align: center; padding: 30px; border: 3px solid #e9ecef; border-radius: 12px; margin-bottom: 20px; background: #fff; }
        #drawnCard { font-size: 2.5rem; color: #333; margin: 10px 0; min-height: 60px; }
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; }
        h3 { font-size: 0.8rem; text-transform: uppercase; color: #666; letter-spacing: 1px; border-bottom: 2px solid #eee; padding-bottom: 5px; margin-top: 0; }
        .list-container { background: #f8f9fa; padding: 15px; border-radius: 8px; font-size: 0.9rem; border: 1px solid #e9ecef; }
        .history-list { grid-column: span 2; max-height: 200px; overflow-y: auto; }
    </style>
</head>
<body>

<div class="card-panel">
    <div class="input-group">
        <input type="text" id="cardName" placeholder="Card Name">
        <input type="number" id="cardQty" placeholder="Qty" min="1" style="width: 80px;">
        <button class="btn-add" onclick="addCards()">Add</button>
    </div>

    <div class="display-area">
        <div id="drawnCard">---</div>
        <button id="drawBtn" class="btn-draw" onclick="drawCard()" disabled>DRAW CARD</button>
        <div style="display: flex; gap: 10px;">
            <button id="shuffleBtn" class="btn-shuffle" onclick="shuffleInitial()" disabled>SHUFFLE (Reset Deck)</button>
            <button class="btn-clear" onclick="fullReset()">CLEAR ALL</button>
        </div>
    </div>

    <div class="grid">
        <div class="list-container">
            <h3>Remaining (<span id="countRem">0</span>)</h3>
            <div id="currentDeckView">Empty</div>
        </div>
        <div class="list-container">
            <h3>Initial Setup</h3>
            <div id="initialDeckView">No configuration.</div>
        </div>
        <div class="list-container history-list">
            <h3>Discard Pile (Order: Newest First)</h3>
            <div id="discardHistory"></div>
        </div>
    </div>
</div>

<script>
    let state = {
        currentDeck: [],
        initialDeck: [],
        discardPile: [],
        lastDrawn: "---"
    };

    // Load data on startup
    window.onload = () => {
        const savedState = localStorage.getItem('deckAppState');
        if (savedState) {
            state = JSON.parse(savedState);
            document.getElementById('drawnCard').innerText = state.lastDrawn;
        }
        updateUI();
    };

    function saveState() {
        localStorage.setItem('deckAppState', JSON.stringify(state));
    }

    function addCards() {
        const nameInput = document.getElementById('cardName');
        const qtyInput = document.getElementById('cardQty');
        const name = nameInput.value.trim();
        const qty = parseInt(qtyInput.value);

        if (name && qty > 0) {
            state.currentDeck.push({ name, qty });
            state.initialDeck.push({ name, qty });
            nameInput.value = '';
            qtyInput.value = '';
            updateUI();
        }
    }

    function drawCard() {
        let pool = [];
        state.currentDeck.forEach((card, index) => {
            for (let i = 0; i < card.qty; i++) pool.push(index);
        });

        if (pool.length === 0) return;

        const randomIndex = pool[Math.floor(Math.random() * pool.length)];
        const selected = state.currentDeck[randomIndex];

        state.lastDrawn = selected.name;
        document.getElementById('drawnCard').innerText = state.lastDrawn;
        state.discardPile.unshift(selected.name);
        selected.qty--;

        if (selected.qty <= 0) state.currentDeck.splice(randomIndex, 1);

        updateUI();
    }

    function shuffleInitial() {
        state.currentDeck = state.initialDeck.map(card => ({ ...card }));
        state.discardPile = [];
        state.lastDrawn = "Deck Shuffled!";
        document.getElementById('drawnCard').innerText = state.lastDrawn;
        updateUI();
    }

    function fullReset() {
        if(confirm("Are you sure? This wipes all saved cards.")) {
            state = { currentDeck: [], initialDeck: [], discardPile: [], lastDrawn: "---" };
            document.getElementById('drawnCard').innerText = state.lastDrawn;
            updateUI();
        }
    }

    function updateUI() {
        const drawBtn = document.getElementById('drawBtn');
        const shuffleBtn = document.getElementById('shuffleBtn');

        let total = 0;
        document.getElementById('currentDeckView').innerHTML = state.currentDeck.map(c => {
            total += c.qty;
            return `<div><strong>${c.qty}x</strong> ${c.name}</div>`;
        }).join('') || "Empty";

        document.getElementById('countRem').innerText = total;

        document.getElementById('initialDeckView').innerHTML = state.initialDeck.map(c =>
            `<div>${c.qty}x ${c.name}</div>`
        ).join('') || "No configuration.";

        document.getElementById('discardHistory').innerHTML = state.discardPile
            .map((name, i) => `<div>${state.discardPile.length - i}. ${name}</div>`)
            .join('');

        drawBtn.disabled = (total === 0);
        shuffleBtn.disabled = (state.initialDeck.length === 0);

        saveState(); // Update browser storage whenever UI changes
    }
</script>
</body>
</html>